(function(r,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("axios"),require("zod"),require("crypto")):typeof define=="function"&&define.amd?define(["exports","axios","zod","crypto"],s):(r=typeof globalThis<"u"?globalThis:r||self,s(r.ShopeeSDK={},r.axios,r.zod,r.crypto))})(this,function(r,s,e,A){"use strict";var X=Object.defineProperty;var Z=(r,s,e)=>s in r?X(r,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[s]=e;var o=(r,s,e)=>(Z(r,typeof s!="symbol"?s+"":s,e),e);const P=class{constructor(){o(this,"axios");o(this,"logger",console);this.axios=s.create(),this.axios.interceptors.request.use(t=>(this.logger.log(`${t.url}`),t.data&&this.logger.info(`[Body]: ${JSON.stringify(t.data,null,4)}`),t),t=>(this.logger.error(t),t)),this.axios.interceptors.response.use(t=>(this.logger.log(`[Response]: ${JSON.stringify(t.data,null,4)}`),t),t=>{const{response:{status:a},message:i,config:{method:p,url:u,data:S,params:_}}=t;return this.logger.error({status:a,message:i,method:p,url:u,data:S,params:_}),t})}static getInstance(){return this.instance??(this.instance=new P)}get(t,a){return this.axios.get(t,{params:a})}post(t,a,i){return this.axios.post(t,i,{params:a})}};let I=P;o(I,"instance");const T=e.z.object({partnerId:e.z.coerce.number().optional(),partnerKey:e.z.coerce.string().optional(),baseURL:e.z.coerce.string().url().optional(),accessToken:e.z.coerce.string().optional(),shopId:e.z.coerce.number().optional()}).safeParse({partnerId:process.env.SHOPEE_SDK_PARTNER_ID,partnerKey:process.env.SHOPEE_SDK_PARTNER_KEY,baseURL:process.env.SHOPEE_SDK_BASE_URL,accessToken:process.env.SHOPEE_SDK_ACCESS_TOKEN,shopId:process.env.SHOPEE_SDK_SHOP_ID});if(!T.success)throw new Error(T.error.message);const h=T.data,R=class{constructor(){o(this,"partnerId");o(this,"partnerKey");o(this,"baseURL");o(this,"accessToken");o(this,"shopId");this.partnerId=h.partnerId??0,this.partnerKey=h.partnerKey??"",this.baseURL=h.baseURL??"",this.accessToken=h.accessToken??"",this.shopId=h.shopId??0}static getInstance(){return this.instance??(this.instance=new R)}get value(){return{partner_id:this.partnerId,partner_key:this.partnerKey,base_url:this.baseURL,access_token:this.accessToken,shop_id:this.shopId}}};let f=R;o(f,"instance");function B(n,...t){const a=A.createHmac("sha256",n);return t.filter(i=>!!i).forEach(i=>a.update(i)),a.digest("hex")}function j(n){const t=n?n.getTime():Date.now();return Math.round(t/1e3).toString()}function N(n){const{partner_id:t,partner_key:a,path:i,base_url:p,access_token:u,shop_id:S,params:_={}}=n,g=t.toString(),m={};for(const y in _){const b=_[y];Array.isArray(b)?m[y]=[b[0],...b.slice(1).map(W=>`&${y}=${W}`)].join(""):b instanceof Date?m[y]=j(b):m[y]=`${b}`}const l=j(),K=new URL(i,p),Q=B(a,g,i,l,u,S.toString());return K.search=new URLSearchParams({...u&&{access_token:u},...m,sign:Q,partner_id:g,timestamp:l}).toString(),K.toString().replace(new RegExp("%26","g"),"&").replace(new RegExp("%3D","g"),"=")}const k=I.getInstance();function w(n){return async function(a){const i=n.transformRequestParameter??(l=>l),p=await n.requestParameterSchema.transform(i).safeParseAsync(a);if(!p.success)throw new Error(p.error.message);const u=p.data,S=f.getInstance().value,_=N({...S,path:n.path,params:u});let g;if(n.method==="POST"){const l=await n.requestBodySchema.safeParseAsync(n.body);if(!l.success)throw new Error(l.error.message);g=(await k.post(_,{},n.body)).data}else g=(await k.get(_)).data;const m=await n.responseSchema.safeParseAsync(g);if(!m.success)throw new Error(m.error.message);return m.data}}const x="/api/v2/product/get_item_list",E=["NORMAL","DELETED","UNLIST","BANNED"],v=e.z.object({offset:e.z.number().int().min(0).optional(),page_size:e.z.number().int().positive().max(100).optional(),update_time_from:e.z.date().optional(),update_time_to:e.z.date().optional(),item_status:e.z.array(e.z.enum(E))}),L=e.z.object({item_id:e.z.number().int(),item_status:e.z.enum(E),update_time:e.z.number().int()}),D=e.z.object({error:e.z.string(),message:e.z.string().nullable().optional(),warning:e.z.string().nullable().optional(),request_id:e.z.string(),response:e.z.object({item:e.z.array(L.optional()).optional()}).optional(),total_count:e.z.number().int().optional(),has_next_page:e.z.boolean().optional(),next_offset:e.z.number().int().optional()}),d=w({method:"GET",path:x,requestParameterSchema:v,transformRequestParameter(n){return n.update_time_from=n.update_time_from??new Date("01/01/2022"),n.update_time_to=n.update_time_to??new Date,n},responseSchema:D}),O="/api/v2/product/get_item_base_info",U=e.z.object({item_id_list:e.z.array(e.z.number().int()).min(1).max(50),need_tax_info:e.z.boolean().optional(),need_complaint_policy:e.z.boolean().optional()}),z=e.z.object({value_id:e.z.number(),original_value_name:e.z.string(),value_unit:e.z.string()}),M=e.z.object({attribute_id:e.z.number(),original_attribute_name:e.z.string(),is_mandatory:e.z.boolean(),attribute_value_list:e.z.array(z)}),H=e.z.object({currency:e.z.string(),original_price:e.z.number(),current_price:e.z.number()}),$=e.z.object({location_id:e.z.string(),stock:e.z.number()}),G=e.z.object({logistic_id:e.z.number(),logistic_name:e.z.string(),enabled:e.z.boolean(),shipping_fee:e.z.number().optional(),is_free:e.z.boolean(),estimated_shipping_fee:e.z.number().optional()}),V=e.z.object({field_type:e.z.string(),text:e.z.string().optional(),image_info:e.z.object({image_id:e.z.string(),image_url:e.z.string()}).optional()}),C=e.z.object({item_id:e.z.number(),category_id:e.z.number(),item_name:e.z.string(),item_sku:e.z.string(),create_time:e.z.number(),update_time:e.z.number(),attribute_list:e.z.array(M),price_info:e.z.array(H),stock_info_v2:e.z.object({summary_info:e.z.object({total_reserved_stock:e.z.number(),total_available_stock:e.z.number()}),seller_stock:e.z.array($)}),image:e.z.object({image_url_list:e.z.array(e.z.string()),image_id_list:e.z.array(e.z.string())}),weight:e.z.string(),dimension:e.z.object({package_length:e.z.number(),package_width:e.z.number(),package_height:e.z.number()}),logistic_info:e.z.array(G),pre_order:e.z.object({is_pre_order:e.z.boolean(),days_to_ship:e.z.number()}),condition:e.z.string(),size_chart:e.z.string(),item_status:e.z.string(),has_model:e.z.boolean(),promotion_id:e.z.number(),brand:e.z.object({brand_id:e.z.number(),original_brand_name:e.z.string()}),tax_info:e.z.object({ncm:e.z.number(),same_state_cfop:e.z.number(),diff_state_cfop:e.z.number(),csosn:e.z.number(),origin:e.z.number()}),description_type:e.z.string(),description_info:e.z.object({extended_description:e.z.object({field_list:e.z.array(V)})})}),q=e.z.object({error:e.z.string(),message:e.z.string(),warning:e.z.string(),request_id:e.z.string(),response:e.z.object({item_list:e.z.array(C).optional()})}),F=w({method:"GET",path:O,requestParameterSchema:U,responseSchema:q}),J=Object.freeze(Object.defineProperty({__proto__:null,product:Object.freeze(Object.defineProperty({__proto__:null,API_V2_PRODUCT_GET_ITEM_BASE_INFO:O,API_V2_PRODUCT_GET_ITEM_LIST:x,ITEM_STATUS:E,getItemBaseInfo:F,getItemBaseInfoRequestParametersSchema:U,getItemBaseInfoResponseSchema:q,getItemList:d,getItemListRequestParametersSchema:v,getItemListResponseSchema:D,itemSchema:L},Symbol.toStringTag,{value:"Module"}))},Symbol.toStringTag,{value:"Module"})),c=f.getInstance();class Y{constructor(t){o(this,"v2",J);c.accessToken=t.accessToken,c.baseURL=t.baseURL,c.partnerId=t.partnerId,c.partnerKey=t.partnerKey,c.accessToken=t.accessToken,c.shopId=t.shopId}setPartnerId(t){return c.partnerId=t,this}setBaseURL(t){return c.baseURL=t,this}setPartnerKey(t){return c.partnerKey=t,this}setAccessToken(t){return c.accessToken=t,this}setShopId(t){return c.shopId=t,this}}r.ShopeeSdk=Y,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
