(function(r,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("axios"),require("zod"),require("crypto")):typeof define=="function"&&define.amd?define(["exports","axios","zod","crypto"],s):(r=typeof globalThis<"u"?globalThis:r||self,s(r.ShopeeSDK={},r.axios,r.zod,r.crypto))})(this,function(r,s,e,z){"use strict";var se=Object.defineProperty;var ae=(r,s,e)=>s in r?se(r,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[s]=e;var c=(r,s,e)=>(ae(r,typeof s!="symbol"?s+"":s,e),e);const R=class{constructor(){c(this,"axios");c(this,"logger",console);this.axios=s.create(),this.axios.interceptors.request.use(t=>(this.logger.log(`${t.url}`),t.data&&this.logger.info(`[Body]: ${JSON.stringify(t.data,null,4)}`),t),t=>(this.logger.error(t),t)),this.axios.interceptors.response.use(t=>(this.logger.log(`[Response]: ${JSON.stringify(t.data,null,4)}`),t),t=>{const{response:{status:a},message:i,config:{method:p,url:u,data:S,params:_}}=t;return this.logger.error({status:a,message:i,method:p,url:u,data:S,params:_}),t})}static getInstance(){return this.instance??(this.instance=new R)}get(t,a){return this.axios.get(t,{params:a})}post(t,a,i){return this.axios.post(t,i,{params:a})}};let y=R;c(y,"instance");const E=e.z.object({partnerId:e.z.coerce.number().optional(),partnerKey:e.z.coerce.string().optional(),baseURL:e.z.coerce.string().url().optional(),accessToken:e.z.coerce.string().optional(),shopId:e.z.coerce.number().optional()}).safeParse({partnerId:process.env.SHOPEE_SDK_PARTNER_ID,partnerKey:process.env.SHOPEE_SDK_PARTNER_KEY,baseURL:process.env.SHOPEE_SDK_BASE_URL,accessToken:process.env.SHOPEE_SDK_ACCESS_TOKEN,shopId:process.env.SHOPEE_SDK_SHOP_ID});if(!E.success)throw new Error(E.error.message);const h=E.data,j=class{constructor(){c(this,"partnerId");c(this,"partnerKey");c(this,"baseURL");c(this,"accessToken");c(this,"shopId");this.partnerId=h.partnerId??0,this.partnerKey=h.partnerKey??"",this.baseURL=h.baseURL??"",this.accessToken=h.accessToken??"",this.shopId=h.shopId??0}static getInstance(){return this.instance??(this.instance=new j)}get value(){return{partner_id:this.partnerId,partner_key:this.partnerKey,base_url:this.baseURL,access_token:this.accessToken,shop_id:this.shopId}}};let f=j;c(f,"instance");function $(n,...t){const a=z.createHmac("sha256",n);return t.filter(i=>!!i).forEach(i=>a.update(i)),a.digest("hex")}function k(n){const t=n?n.getTime():Date.now();return Math.round(t/1e3).toString()}function G(n){const{partner_id:t,partner_key:a,path:i,base_url:p,access_token:u,shop_id:S,params:_={}}=n,l=t.toString(),g=S.toString(),m={};for(const I in _){const b=_[I];Array.isArray(b)?m[I]=[b[0],...b.slice(1).map(re=>`&${I}=${re}`)].join(""):b instanceof Date?m[I]=k(b):m[I]=`${b}`}const N=k(),M=new URL(i,p),ne=$(a,l,i,N,u,g);return M.search=new URLSearchParams({...m,partner_id:l,shop_id:g,access_token:u,sign:ne,timestamp:N}).toString(),M.toString().replace(new RegExp("%26","g"),"&").replace(new RegExp("%3D","g"),"=")}const x=y.getInstance();function T(n){return async function(a){const i=n.transformRequestParameter??(m=>m),p=await n.requestParameterSchema.transform(i).safeParseAsync(a);if(!p.success)throw new Error(p.error.message);const u=p.data,S=f.getInstance().value,_=G({...S,path:n.path,params:u});let l;if(n.method==="POST"){const m=await n.requestBodySchema.safeParseAsync(n.body);if(!m.success)throw new Error(m.error.message);l=(await x.post(_,{},n.body)).data}else l=(await x.get(_)).data;const g=await n.responseSchema.safeParseAsync(l);if(!g.success)throw new Error(g.error.message);return g.data}}const w="/api/v2/product/get_item_list",P=["NORMAL","DELETED","UNLIST","BANNED"],v=e.z.object({offset:e.z.number().int().min(0).optional(),page_size:e.z.number().int().positive().max(100).optional(),update_time_from:e.z.date().optional(),update_time_to:e.z.date().optional(),item_status:e.z.array(e.z.enum(P))}),q=e.z.object({item_id:e.z.number().int(),item_status:e.z.enum(P),update_time:e.z.number().int()}),L=e.z.object({error:e.z.string(),message:e.z.string().nullable().optional(),warning:e.z.string().nullable().optional(),request_id:e.z.string(),response:e.z.object({item:e.z.array(q.optional()).optional()}).optional(),total_count:e.z.number().int().optional(),has_next_page:e.z.boolean().optional(),next_offset:e.z.number().int().optional()}),H=T({method:"GET",path:w,requestParameterSchema:v,transformRequestParameter(n){return n.update_time_from=n.update_time_from??new Date("01/01/2022"),n.update_time_to=n.update_time_to??new Date,n},responseSchema:L}),O="/api/v2/product/get_item_base_info",D=e.z.object({item_id_list:e.z.string(),need_tax_info:e.z.coerce.boolean().optional(),need_complaint_policy:e.z.coerce.boolean().optional()}),V=e.z.object({value_id:e.z.number(),original_value_name:e.z.string(),value_unit:e.z.string()}),C=e.z.object({attribute_id:e.z.number(),original_attribute_name:e.z.string(),is_mandatory:e.z.boolean(),attribute_value_list:e.z.array(V)}),F=e.z.object({currency:e.z.string(),original_price:e.z.number(),current_price:e.z.number()}),d=e.z.object({location_id:e.z.string(),stock:e.z.number()}),J=e.z.object({logistic_id:e.z.number(),logistic_name:e.z.string(),enabled:e.z.boolean(),shipping_fee:e.z.number().optional(),is_free:e.z.boolean(),estimated_shipping_fee:e.z.number().optional()}),X=e.z.object({field_type:e.z.string(),text:e.z.string().optional(),image_info:e.z.object({image_id:e.z.string(),image_url:e.z.string()}).optional()}),Y=e.z.object({item_id:e.z.number(),category_id:e.z.number(),item_name:e.z.string(),item_sku:e.z.string(),create_time:e.z.number(),update_time:e.z.number(),attribute_list:e.z.array(C).optional(),price_info:e.z.array(F).optional(),stock_info_v2:e.z.object({summary_info:e.z.object({total_reserved_stock:e.z.number(),total_available_stock:e.z.number()}),seller_stock:e.z.array(d).optional()}).optional(),image:e.z.object({image_url_list:e.z.array(e.z.string()),image_id_list:e.z.array(e.z.string())}),weight:e.z.string(),dimension:e.z.object({package_length:e.z.number(),package_width:e.z.number(),package_height:e.z.number()}),logistic_info:e.z.array(J),pre_order:e.z.object({is_pre_order:e.z.boolean(),days_to_ship:e.z.number()}),condition:e.z.string(),size_chart:e.z.string(),item_status:e.z.string(),has_model:e.z.boolean(),promotion_id:e.z.number().optional(),brand:e.z.object({brand_id:e.z.number(),original_brand_name:e.z.string()}),tax_info:e.z.object({ncm:e.z.number(),same_state_cfop:e.z.number(),diff_state_cfop:e.z.number(),csosn:e.z.number(),origin:e.z.number()}).optional(),description_type:e.z.string(),description_info:e.z.object({extended_description:e.z.object({field_list:e.z.array(X)})})}),U=e.z.object({error:e.z.string(),message:e.z.string(),warning:e.z.string(),request_id:e.z.string(),response:e.z.object({item_list:e.z.array(Y).optional()})}),Q=T({method:"GET",path:O,requestParameterSchema:D,responseSchema:U,transformRequestParameter(n){return n.need_tax_info=!!n.need_tax_info,n.need_complaint_policy=!!n.need_complaint_policy,n}}),A="/api/v2/product/get_item_extra_info",K=e.z.object({item_id_list:e.z.string()}),W=e.z.object({item_id:e.z.number(),sale:e.z.number(),views:e.z.number(),likes:e.z.number(),rating_star:e.z.number(),comment_count:e.z.number()}),B=e.z.object({error:e.z.string(),message:e.z.string(),warning:e.z.string().optional(),request_id:e.z.string(),response:e.z.object({item_list:e.z.array(W).optional()}).optional()}),Z=T({method:"GET",path:A,requestParameterSchema:K,responseSchema:B}),ee=Object.freeze(Object.defineProperty({__proto__:null,product:Object.freeze(Object.defineProperty({__proto__:null,API_V2_PRODUCT_GET_ITEM_BASE_INFO:O,API_V2_PRODUCT_GET_ITEM_EXTRA_INFO:A,API_V2_PRODUCT_GET_ITEM_LIST:w,ITEM_STATUS:P,getItemBaseInfo:Q,getItemBaseInfoRequestParametersSchema:D,getItemBaseInfoResponseSchema:U,getItemExtraInfo:Z,getItemExtraInfoRequestParametersSchema:K,getItemExtraInfoResponseSchema:B,getItemList:H,getItemListRequestParametersSchema:v,getItemListResponseSchema:L,itemSchema:q},Symbol.toStringTag,{value:"Module"}))},Symbol.toStringTag,{value:"Module"})),o=f.getInstance();class te{constructor(t){c(this,"v2",ee);o.accessToken=t.accessToken,o.baseURL=t.baseURL,o.partnerId=t.partnerId,o.partnerKey=t.partnerKey,o.accessToken=t.accessToken,o.shopId=t.shopId}setPartnerId(t){return o.partnerId=t,this}setBaseURL(t){return o.baseURL=t,this}setPartnerKey(t){return o.partnerKey=t,this}setAccessToken(t){return o.accessToken=t,this}setShopId(t){return o.shopId=t,this}}r.ShopeeSdk=te,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
