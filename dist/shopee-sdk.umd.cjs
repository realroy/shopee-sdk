(function(r,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("axios"),require("zod"),require("crypto")):typeof define=="function"&&define.amd?define(["exports","axios","zod","crypto"],a):(r=typeof globalThis<"u"?globalThis:r||self,a(r.ShopeeSDK={},r.axios,r.zod,r.crypto))})(this,function(r,a,e,U){"use strict";var W=Object.defineProperty;var X=(r,a,e)=>a in r?W(r,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[a]=e;var c=(r,a,e)=>(X(r,typeof a!="symbol"?a+"":a,e),e);const T=class{constructor(){c(this,"axios");c(this,"logger",console);this.axios=a.create(),this.axios.interceptors.request.use(n=>(this.logger.log(`${n.url}`),n.data&&this.logger.info(`[Body]: ${JSON.stringify(n.data,null,4)}`),n),n=>(this.logger.error(n),n)),this.axios.interceptors.response.use(n=>(this.logger.log(`[Response]: ${JSON.stringify(n.data,null,4)}`),n),n=>{const{response:{status:i},message:o,config:{method:m,url:l,data:g,params:_}}=n;return this.logger.error({status:i,message:o,method:m,url:l,data:g,params:_}),n})}static getInstance(){return this.instance??(this.instance=new T)}get(n,i){return this.axios.get(n,{params:i})}post(n,i,o){return this.axios.post(n,o,{params:i})}};let I=T;c(I,"instance");const P=e.z.object({partnerId:e.z.coerce.number().optional(),partnerKey:e.z.coerce.string().optional(),baseURL:e.z.coerce.string().url().optional(),accessToken:e.z.coerce.string().optional(),shopId:e.z.coerce.number().optional()}).safeParse({partnerId:process.env.SHOPEE_SDK_PARTNER_ID,partnerKey:process.env.SHOPEE_SDK_PARTNER_KEY,baseURL:process.env.SHOPEE_SDK_APP_BASE_URL,accessToken:process.env.SHOPEE_SDK_APP_ACCESS_TOKEN,shopId:process.env.SHOPEE_SDK_APP_SHOP_ID});if(!P.success)throw new Error(P.error.message);const f=P.data,j=class{constructor(){c(this,"partnerId");c(this,"partnerKey");c(this,"baseURL");c(this,"accessToken");c(this,"shopId");this.partnerId=f.partnerId,this.partnerKey=f.partnerKey,this.baseURL=f.baseURL,this.accessToken=f.accessToken??"",this.shopId=f.shopId}static getInstance(){return this.instance??(this.instance=new j)}get value(){return{partner_id:this.partnerId,partner_key:this.partnerKey,base_url:this.baseURL,access_token:this.accessToken,shop_id:this.shopId}}};let S=j;c(S,"instance");function K(t,...n){const i=U.createHmac("sha256",t);return n.filter(o=>!!o).forEach(o=>i.update(o)),i.digest("hex")}function R(t){const n=t?t.getTime():Date.now();return Math.round(n/1e3).toString()}function B(t){const{partner_id:n,partner_key:i,path:o,base_url:m,access_token:l,params:g={}}=t,_=n.toString(),s={};for(const u in g){const h=g[u];Array.isArray(h)?s[u]=[h[0],...h.slice(1).map(Q=>`&${u}=${Q}`)].join(""):h instanceof Date?s[u]=R(h):s[u]=`${h}`}const b=R(),p=new URL(o,m),Y=K(i,_,o,b,...[s==null?void 0:s.access_token,s==null?void 0:s.shop_id].filter(u=>typeof u<"u"));return p.search=new URLSearchParams({...l&&{access_token:l},...s,sign:Y,partner_id:_,timestamp:b}).toString(),p.toString().replace(new RegExp("%26","g"),"&").replace(new RegExp("%3D","g"),"=")}const k=I.getInstance();function w(t){return async function(i){const o=t.transformRequestParameter??(p=>p),m=await t.requestParameterSchema.transform(o).safeParseAsync(i);if(!m.success)throw new Error(m.error.message);const l=m.data,g=S.getInstance().value,_=B({...g,path:t.path,params:l});let s;if(t.method==="POST"){const p=await t.requestBodySchema.safeParseAsync(t.body);if(!p.success)throw new Error(p.error.message);s=(await k.post(_,{},t.body)).data}else s=(await k.get(_)).data;const b=await t.responseSchema.safeParseAsync(s);if(!b.success)throw new Error(b.error.message);return b.data}}const x="/api/v2/product/get_item_list",E=["NORMAL","DELETED","UNLIST","BANNED"],v=e.z.object({offset:e.z.number().int().min(0).optional(),page_size:e.z.number().int().positive().max(100).optional(),update_time_from:e.z.date().optional(),update_time_to:e.z.date().optional(),item_status:e.z.array(e.z.enum(E))}),A=e.z.object({item_id:e.z.number().int(),item_status:e.z.enum(E),update_time:e.z.number().int()}),D=e.z.object({error:e.z.string(),message:e.z.string().nullable().optional(),warning:e.z.string().nullable().optional(),request_id:e.z.string(),response:e.z.object({item:e.z.array(A.optional()).optional()}).optional(),total_count:e.z.number().int().optional(),has_next_page:e.z.boolean().optional(),next_offset:e.z.number().int().optional()}),N=w({method:"GET",path:x,requestParameterSchema:v,transformRequestParameter(t){return t.update_time_from=t.update_time_from??new Date("01/01/2022"),t.update_time_to=t.update_time_to??new Date,t},responseSchema:D}),L="/api/v2/product/get_item_base_info",O=e.z.object({item_id_list:e.z.array(e.z.number().int()).min(1).max(50),need_tax_info:e.z.boolean().optional(),need_complaint_policy:e.z.boolean().optional()}),z=e.z.object({value_id:e.z.number(),original_value_name:e.z.string(),value_unit:e.z.string()}),M=e.z.object({attribute_id:e.z.number(),original_attribute_name:e.z.string(),is_mandatory:e.z.boolean(),attribute_value_list:e.z.array(z)}),H=e.z.object({currency:e.z.string(),original_price:e.z.number(),current_price:e.z.number()}),$=e.z.object({location_id:e.z.string(),stock:e.z.number()}),G=e.z.object({logistic_id:e.z.number(),logistic_name:e.z.string(),enabled:e.z.boolean(),shipping_fee:e.z.number().optional(),is_free:e.z.boolean(),estimated_shipping_fee:e.z.number().optional()}),d=e.z.object({field_type:e.z.string(),text:e.z.string().optional(),image_info:e.z.object({image_id:e.z.string(),image_url:e.z.string()}).optional()}),V=e.z.object({item_id:e.z.number(),category_id:e.z.number(),item_name:e.z.string(),item_sku:e.z.string(),create_time:e.z.number(),update_time:e.z.number(),attribute_list:e.z.array(M),price_info:e.z.array(H),stock_info_v2:e.z.object({summary_info:e.z.object({total_reserved_stock:e.z.number(),total_available_stock:e.z.number()}),seller_stock:e.z.array($)}),image:e.z.object({image_url_list:e.z.array(e.z.string()),image_id_list:e.z.array(e.z.string())}),weight:e.z.string(),dimension:e.z.object({package_length:e.z.number(),package_width:e.z.number(),package_height:e.z.number()}),logistic_info:e.z.array(G),pre_order:e.z.object({is_pre_order:e.z.boolean(),days_to_ship:e.z.number()}),condition:e.z.string(),size_chart:e.z.string(),item_status:e.z.string(),has_model:e.z.boolean(),promotion_id:e.z.number(),brand:e.z.object({brand_id:e.z.number(),original_brand_name:e.z.string()}),tax_info:e.z.object({ncm:e.z.number(),same_state_cfop:e.z.number(),diff_state_cfop:e.z.number(),csosn:e.z.number(),origin:e.z.number()}),description_type:e.z.string(),description_info:e.z.object({extended_description:e.z.object({field_list:e.z.array(d)})})}),q=e.z.object({error:e.z.string(),message:e.z.string(),warning:e.z.string(),request_id:e.z.string(),response:e.z.object({item_list:e.z.array(V).optional()})}),C=w({method:"GET",path:L,requestParameterSchema:O,responseSchema:q}),F=Object.freeze(Object.defineProperty({__proto__:null,product:Object.freeze(Object.defineProperty({__proto__:null,API_V2_PRODUCT_GET_ITEM_BASE_INFO:L,API_V2_PRODUCT_GET_ITEM_LIST:x,ITEM_STATUS:E,getItemBaseInfo:C,getItemBaseInfoRequestParametersSchema:O,getItemBaseInfoResponseSchema:q,getItemList:N,getItemListRequestParametersSchema:v,getItemListResponseSchema:D,itemSchema:A},Symbol.toStringTag,{value:"Module"}))},Symbol.toStringTag,{value:"Module"})),y=S.getInstance(),J={v2:F,setPartnerId(t){return y.partnerId=t,this},setBaseURL(t){return y.baseURL=t,this},setPartnerKey(t){return y.partnerKey=t,this},setAccessToken(t){return y.accessToken=t,this},setShopId(t){return y.shopId=t,this}};r.ShopeeSdk=J,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
