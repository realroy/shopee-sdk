(function(i,y){typeof exports=="object"&&typeof module<"u"?y(exports,require("axios"),require("zod")):typeof define=="function"&&define.amd?define(["exports","axios","zod"],y):(i=typeof globalThis<"u"?globalThis:i||self,y(i.ShopeeSDK={},i.axios,i.zod))})(this,function(i,y,e){"use strict";async function R(r,...t){let a;return typeof globalThis.crypto<"u"&&(a=await G(r,...t)),a=await z(r,...t),a}async function G(r,...t){const a=new TextEncoder,n=a.encode(r);let s=new Uint8Array;t.forEach(u=>{u&&(s=a.encode(u))});const c=await crypto.subtle.importKey("raw",n,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),o=await crypto.subtle.sign({name:"HMAC",hash:{name:"sha-256"}},c,s),p=new Uint8Array(o);return Array.from(p).map(u=>u.toString(16).padStart(2,"0")).join("")}async function z(r,...t){const{createHmac:a}=await import("crypto"),n=a("sha256",r);return t.filter(s=>!!s).forEach(s=>n.update(s)),n.digest("hex")}function I(r){const t=r?r.getTime():Date.now();return Math.round(t/1e3).toString()}async function A(r){const{partner_id:t,partner_key:a,path:n,base_url:s,access_token:c,shop_id:o,params:p={}}=r,m=t.toString(),u=o.toString(),l={};for(const E in p){const f=p[E];Array.isArray(f)?l[E]=[f[0],...f.slice(1).map(Se=>`&${E}=${Se}`)].join(""):f instanceof Date?l[E]=I(f):l[E]=`${f}`}const g=I(),T=new URL(n,s),ye=await R(a,m,n,g,c,u);return T.search=new URLSearchParams({...l,partner_id:m,shop_id:u,...!!c&&{access_token:c},sign:ye,timestamp:g}).toString(),T.toString().replace(new RegExp("%26","g"),"&").replace(new RegExp("%3D","g"),"=")}class P{constructor(){this.logger=console,this.logInterceptorIds=[],this.isLogEnabled=!1,this.axios=y.create(),this.isLogEnabled&&this.addLogInterceptor()}addLogInterceptor(){const t=this.axios.interceptors.request.use(n=>(this.logger.log(`${n.url}`),n.data&&this.logger.info(`[Body]: ${JSON.stringify(n.data,null,4)}`),n),n=>{throw this.logger.error(n),n}),a=this.axios.interceptors.response.use(n=>(this.logger.log(`[Response]: ${JSON.stringify(n.data,null,4)}`),n),n=>{const{response:s,message:c,config:{method:o,url:p,data:m,params:u}}=n,l=s==null?void 0:s.status;throw this.logger.error({status:l,message:c,method:o,url:p,data:m,params:u}),n});this.logInterceptorIds=[t,a]}removeLogInterceptor(){this.logInterceptorIds.forEach(this.axios.interceptors.request.eject)}static getInstance(){return this.instance??(this.instance=new P)}setLogEnabled(t){return this.isLogEnabled=t,this.isLogEnabled?this.addLogInterceptor():this.removeLogInterceptor(),this.isLogEnabled}get(t,a){return this.axios.get(t,{params:a})}post(t,a,n){return this.axios.post(t,n,{params:a})}}class b{constructor(){this.isLogEnabled=!1}static getInstance(){return this.instance??(this.instance=new b)}get value(){return{partner_id:this.partnerId??"",partner_key:this.partnerKey??"",base_url:this.baseURL??"",access_token:this.accessToken??"",shop_id:this.shopId??""}}}const w=P.getInstance();function h(r){return async function(a){const n=r.transformRequestParameter??(T=>T),s=await r.requestParameterSchema.transform(n).safeParseAsync(a);if(!s.success)throw new Error(`parse request parameters error: ${s.error.message}`);const c=s.data,o=b.getInstance(),p=o.value;w.setLogEnabled(o.isLogEnabled);const m=await A({...p,path:r.path,params:c}),l=(await w.get(m)).data,g=await r.responseSchema.safeParseAsync(l);if(!g.success)throw new Error(`parse response error: ${g.error.message}`);return g.data}}const D=P.getInstance();function B(r){return async function(a){const n=r.transformRequestParameter??(g=>g),s=await r.requestParameterSchema.transform(n).safeParseAsync(a);if(!s.success)throw new Error(`parse request parameters error: ${s.error.message}`);const c=b.getInstance(),o=c.value;D.setLogEnabled(c.isLogEnabled);const p=await A({...o,path:r.path,params:{}}),m=s.data,{data:u}=await D.post(p,{},m),l=await r.responseSchema.safeParseAsync(u);if(!l.success)throw new Error(`parse response error: ${l.error.message}`);return l.data}}const k="/api/v2/order/get_order_list",v="/api/v2/order/get_order_detail",q=["UNPAID","READY_TO_SHIP","PROCESSED","SHIPPED","COMPLETED","IN_CANCEL","CANCELLED","INVOICE_PENDING"],U=["buyer_user_id","buyer_username","estimated_shipping_fee","recipient_address","actual_shipping_fee","goods_to_declare","note","note_update_time","item_list","pay_time","dropshipper","dropshipper_phone","split_up","buyer_cancel_reason","cancel_by","cancel_reason","actual_shipping_fee_confirmed","buyer_cpf_id","fulfillment_flag","pickup_done_time","package_list","shipping_carrier","payment_method","total_amount","buyer_username","invoice_data","checkout_shipping_carrier","reverse_shipping_fee","order_chargeable_weight_gram","edt","prescription_images","prescription_check_status"],$=e.z.object({order_sn_list:e.z.array(e.z.string()),response_optional_fields:e.z.array(e.z.enum(U)).optional()}),d=e.z.object({error:e.z.string().optional(),message:e.z.string().optional(),response:e.z.object({order_list:e.z.array(e.z.object({checkout_shipping_carrier:e.z.null(),reverse_shipping_fee:e.z.null(),actual_shipping_fee:e.z.null(),actual_shipping_fee_confirmed:e.z.boolean(),buyer_cancel_reason:e.z.string(),buyer_cpf_id:e.z.null(),buyer_user_id:e.z.number(),buyer_username:e.z.string(),cancel_by:e.z.string(),cancel_reason:e.z.string(),cod:e.z.boolean(),create_time:e.z.number(),currency:e.z.string(),days_to_ship:e.z.number(),dropshipper:e.z.string(),dropshipper_phone:e.z.string(),estimated_shipping_fee:e.z.number(),fulfillment_flag:e.z.string(),goods_to_declare:e.z.boolean(),invoice_data:e.z.null(),item_list:e.z.array(e.z.object({item_id:e.z.number(),item_name:e.z.string(),item_sku:e.z.string(),model_id:e.z.number(),model_name:e.z.string(),model_sku:e.z.string(),model_quantity_purchased:e.z.number(),model_original_price:e.z.number(),model_discounted_price:e.z.number(),wholesale:e.z.boolean(),weight:e.z.number(),add_on_deal:e.z.boolean(),main_item:e.z.boolean(),add_on_deal_id:e.z.number(),promotion_type:e.z.string(),promotion_id:e.z.number(),order_item_id:e.z.number(),promotion_group_id:e.z.number(),image_info:e.z.object({image_url:e.z.string()}),product_location_id:e.z.array(e.z.string())})),message_to_seller:e.z.string(),note:e.z.string(),note_update_time:e.z.number(),order_sn:e.z.string(),order_status:e.z.string(),package_list:e.z.array(e.z.object({package_number:e.z.string(),logistics_status:e.z.string(),shipping_carrier:e.z.string(),item_list:e.z.array(e.z.object({item_id:e.z.number(),model_id:e.z.number(),model_quantity:e.z.number()}))})),pay_time:e.z.number(),payment_method:e.z.string(),pickup_done_time:e.z.number(),recipient_address:e.z.object({name:e.z.string(),phone:e.z.string(),town:e.z.string(),district:e.z.string(),city:e.z.string(),state:e.z.string(),region:e.z.string(),zipcode:e.z.string(),full_address:e.z.string()}),region:e.z.string(),ship_by_date:e.z.number(),shipping_carrier:e.z.string(),split_up:e.z.boolean(),total_amount:e.z.number(),update_time:e.z.number()}))}),request_id:e.z.string()}),F=h({path:v,requestParameterSchema:$,responseSchema:d}),Q=e.z.object({time_range_field:e.z.enum(["create_time","update_time"]),time_from:e.z.date(),time_to:e.z.date(),page_size:e.z.number().min(1).max(100),cursor:e.z.string().optional(),order_status:e.z.enum(q).optional(),response_optional_fields:e.z.enum(["order_status"]).optional().default("order_status")}),W=e.z.object({error:e.z.string().optional(),message:e.z.string().optional(),response:e.z.object({more:e.z.boolean(),next_cursor:e.z.string(),order_list:e.z.array(e.z.object({order_sn:e.z.string()}))}),request_id:e.z.string()}),J=h({path:k,requestParameterSchema:Q,responseSchema:W}),X=Object.freeze(Object.defineProperty({__proto__:null,getOrderDetail:F,getOrderList:J},Symbol.toStringTag,{value:"Module"})),H="/api/v2/product/get_item_base_info",C="/api/v2/product/get_item_extra_info",N="/api/v2/product/get_item_list",x="/api/v2/product/get_model_list",L=["NORMAL","DELETED","UNLIST","BANNED"],Y=e.z.object({item_id_list:e.z.string(),need_tax_info:e.z.coerce.boolean().optional(),need_complaint_policy:e.z.coerce.boolean().optional()}),Z=e.z.object({error:e.z.string(),message:e.z.string(),warning:e.z.string(),request_id:e.z.string(),response:e.z.object({item_list:e.z.array(e.z.object({item_id:e.z.number(),category_id:e.z.number(),item_name:e.z.string(),item_sku:e.z.string(),create_time:e.z.number(),update_time:e.z.number(),attribute_list:e.z.array(e.z.object({attribute_id:e.z.number(),original_attribute_name:e.z.string(),is_mandatory:e.z.boolean(),attribute_value_list:e.z.array(e.z.object({value_id:e.z.number(),original_value_name:e.z.string(),value_unit:e.z.string()}))})).optional(),price_info:e.z.array(e.z.object({currency:e.z.string(),original_price:e.z.number(),current_price:e.z.number()})).optional(),stock_info_v2:e.z.object({summary_info:e.z.object({total_reserved_stock:e.z.number(),total_available_stock:e.z.number()}),seller_stock:e.z.array(e.z.object({location_id:e.z.string(),stock:e.z.number()})).optional()}).optional(),image:e.z.object({image_url_list:e.z.array(e.z.string()),image_id_list:e.z.array(e.z.string())}),weight:e.z.string(),dimension:e.z.object({package_length:e.z.number(),package_width:e.z.number(),package_height:e.z.number()}),logistic_info:e.z.array(e.z.object({logistic_id:e.z.number(),logistic_name:e.z.string(),enabled:e.z.boolean(),shipping_fee:e.z.number().optional(),is_free:e.z.boolean(),estimated_shipping_fee:e.z.number().optional()})).optional(),pre_order:e.z.object({is_pre_order:e.z.boolean(),days_to_ship:e.z.number()}),condition:e.z.string(),size_chart:e.z.string(),item_status:e.z.string(),has_model:e.z.boolean(),promotion_id:e.z.number().optional(),brand:e.z.object({brand_id:e.z.number(),original_brand_name:e.z.string()}),tax_info:e.z.object({ncm:e.z.number(),same_state_cfop:e.z.number(),diff_state_cfop:e.z.number(),csosn:e.z.number(),origin:e.z.number()}).optional(),description_type:e.z.string(),description_info:e.z.object({extended_description:e.z.object({field_list:e.z.array(e.z.object({field_type:e.z.string(),text:e.z.string().optional(),image_info:e.z.object({image_id:e.z.string(),image_url:e.z.string()}).optional()}))}).optional()}).optional()})).optional()})}),ee=h({path:H,requestParameterSchema:Y,responseSchema:Z,transformRequestParameter(r){return r.need_tax_info=!!r.need_tax_info,r.need_complaint_policy=!!r.need_complaint_policy,r}}),te=e.z.object({item_id_list:e.z.string()}),re=e.z.object({error:e.z.string(),message:e.z.string(),warning:e.z.string().optional(),request_id:e.z.string(),response:e.z.object({item_list:e.z.array(e.z.object({item_id:e.z.number(),sale:e.z.number(),views:e.z.number(),likes:e.z.number(),rating_star:e.z.number(),comment_count:e.z.number()})).optional()}).optional()}),ne=h({path:C,requestParameterSchema:te,responseSchema:re}),se=e.z.object({offset:e.z.number().int().min(0).optional(),page_size:e.z.number().int().positive().max(100).optional(),update_time_from:e.z.date().optional(),update_time_to:e.z.date().optional(),item_status:e.z.array(e.z.enum(L))}),ae=e.z.object({error:e.z.string(),message:e.z.string().nullable().optional(),warning:e.z.string().nullable().optional(),request_id:e.z.string(),response:e.z.object({item:e.z.array(e.z.object({item_id:e.z.number().int(),item_status:e.z.enum(L),update_time:e.z.number().int()})).optional()}).optional(),total_count:e.z.number().int().optional(),has_next_page:e.z.boolean().optional(),next_offset:e.z.number().int().optional()}),ie=h({path:N,requestParameterSchema:se,transformRequestParameter(r){return r.update_time_from=r.update_time_from??new Date("01/01/2022"),r.update_time_to=r.update_time_to??new Date,r},responseSchema:ae}),ce=e.z.object({item_id:e.z.string()}),oe=e.z.object({error:e.z.string(),message:e.z.string(),warning:e.z.string(),request_id:e.z.string(),response:e.z.object({tier_variation:e.z.array(e.z.object({name:e.z.string(),option_list:e.z.array(e.z.object({option:e.z.string()}))})),model:e.z.array(e.z.object({model_id:e.z.number(),model_status:e.z.string(),promotion_id:e.z.number(),tier_index:e.z.array(e.z.number()),price_info:e.z.array(e.z.object({current_price:e.z.number(),original_price:e.z.number(),inflated_price_of_current_price:e.z.number(),inflated_price_of_original_price:e.z.number()})),model_sku:e.z.string(),pre_order:e.z.object({is_pre_order:e.z.boolean(),days_to_ship:e.z.number()}),stock_info_v2:e.z.object({summary_info:e.z.object({total_reserved_stock:e.z.number(),total_available_stock:e.z.number()}),seller_stock:e.z.array(e.z.object({location_id:e.z.string(),stock:e.z.number()}))})}))})}),_e=h({path:x,requestParameterSchema:ce,responseSchema:oe}),pe=Object.freeze(Object.defineProperty({__proto__:null,getItemBaseInfo:ee,getItemExtraInfo:ne,getItemList:ie,getModelList:_e},Symbol.toStringTag,{value:"Module"})),M="/api/v2/auth/token/get",K=e.z.object({code:e.z.string(),partner_id:e.z.number().optional(),shop_id:e.z.number().optional(),main_account_id:e.z.number().optional()}),V=e.z.object({access_token:e.z.string(),error:e.z.string(),expires_in:e.z.number(),message:e.z.string(),refresh_token:e.z.string(),request_id:e.z.string(),shop_id_list:e.z.array(e.z.number())}),me=B({path:M,requestParameterSchema:K,responseSchema:V,transformRequestParameter(r){return r.partner_id=r.partner_id??b.getInstance().partnerId,r}}),ue=Object.freeze(Object.defineProperty({__proto__:null,getAccessToken:me,getAccessTokenRequestParametersSchema:K,getAccessTokenResponseSchema:V},Symbol.toStringTag,{value:"Module"})),j="/api/v2/shop/auth_partner";async function le({redirectURL:r,redirectSign:t}){const{baseURL:a,partnerId:n,partnerKey:s}=b.getInstance();if(!s||!n)throw new Error("partnerKey is undefined");const c=new URL(j,a),o=I(new Date),p=await R(s,n.toString(),j,o),m=new URL(r);return m.searchParams.append("sign",t),c.search=new URLSearchParams({partner_id:n.toString(),redirect:m.toString(),timestamp:o,sign:p}).toString(),c.toString()}const ge=e.z.object({code:e.z.string(),shop_id:e.z.string(),sign:e.z.string()});async function be(r){const t=await ge.safeParseAsync(r);if(!t.success)throw new Error(`parse request parameters error: ${t.error.message}`);const{code:a,shop_id:n,sign:s}=t.data;return{code:a,shopId:n,sign:s}}const he=Object.freeze(Object.defineProperty({__proto__:null,order:X,product:pe,publicShopee:ue,shop:Object.freeze(Object.defineProperty({__proto__:null,authPartner:le,verifyCallback:be},Symbol.toStringTag,{value:"Module"}))},Symbol.toStringTag,{value:"Module"})),O=e.z.object({partnerId:e.z.coerce.number().optional(),partnerKey:e.z.coerce.string().optional(),baseURL:e.z.coerce.string().url().optional(),accessToken:e.z.coerce.string().optional(),shopId:e.z.coerce.number().optional()}).safeParse({partnerId:process.env.SHOPEE_SDK_PARTNER_ID,partnerKey:process.env.SHOPEE_SDK_PARTNER_KEY,baseURL:process.env.SHOPEE_SDK_BASE_URL,accessToken:process.env.SHOPEE_SDK_ACCESS_TOKEN,shopId:process.env.SHOPEE_SDK_SHOP_ID});if(!O.success)throw new Error(O.error.message);const S=O.data,_=b.getInstance();class fe{constructor(t){_.accessToken=t.accessToken??S.accessToken,_.baseURL=t.baseURL??S.baseURL,_.partnerId=t.partnerId??S.partnerId,_.partnerKey=t.partnerKey??S.partnerKey,_.shopId=t.shopId??S.shopId,_.isLogEnabled=t.isLogEnabled??!1}setPartnerId(t){return _.partnerId=t,this}setBaseURL(t){return _.baseURL=t,this}setPartnerKey(t){return _.partnerKey=t,this}setAccessToken(t){return _.accessToken=t,this}setShopId(t){return _.shopId=t,this}setIsLogEnabled(t){return _.isLogEnabled=t,this}get v2(){return he}}i.API_V2_ORDER_GET_ORDER_DETAIL_PATH=v,i.API_V2_ORDER_GET_ORDER_LIST_PATH=k,i.API_V2_PRODUCT_GET_ITEM_BASE_INFO_PATH=H,i.API_V2_PRODUCT_GET_ITEM_EXTRA_INFO_PATH=C,i.API_V2_PRODUCT_GET_ITEM_LIST_PATH=N,i.API_V2_PRODUCT_GET_MODEL_LIST_PATH=x,i.API_V2_PUBLIC_GET_ACCESS_TOKEN_PATH=M,i.API_V2_SHOP_AUTH_PARTNER=j,i.ITEM_STATUS=L,i.ORDER_RESPONSE_OPTIONAL_FIELDS=U,i.ORDER_STATUS=q,i.ShopeeSdk=fe,i.generateHmac=R,i.signURL=A,i.toTimestamp=I,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
