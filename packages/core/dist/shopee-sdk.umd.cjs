(function(s,b){typeof exports=="object"&&typeof module<"u"?b(exports,require("axios"),require("zod")):typeof define=="function"&&define.amd?define(["exports","axios","zod"],b):(s=typeof globalThis<"u"?globalThis:s||self,b(s.ShopeeSDK={},s.axios,s.zod))})(this,function(s,b,e){"use strict";async function T(n,...t){let r;return typeof globalThis.crypto<"u"&&(r=await H(n,...t)),r=await k(n,...t),r}async function H(n,...t){const r=new TextEncoder,a=r.encode(n);let i=new Uint8Array;t.forEach(p=>{p&&(i=r.encode(p))});const c=await crypto.subtle.importKey("raw",a,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),u=await crypto.subtle.sign({name:"HMAC",hash:{name:"sha-256"}},c,i),_=new Uint8Array(u);return Array.from(_).map(p=>p.toString(16).padStart(2,"0")).join("")}async function k(n,...t){const{createHmac:r}=await import("crypto"),a=r("sha256",n);return t.filter(i=>!!i).forEach(i=>a.update(i)),a.digest("hex")}function y(n){const t=n?n.getTime():Date.now();return Math.round(t/1e3).toString()}async function w(n){const{partner_id:t,partner_key:r,path:a,base_url:i,access_token:c,shop_id:u,params:_={}}=n,o=t.toString(),p=u.toString(),l={};for(const S in _){const g=_[S];Array.isArray(g)?l[S]=[g[0],...g.slice(1).map(X=>`&${S}=${X}`)].join(""):g instanceof Date?l[S]=y(g):l[S]=`${g}`}const L=y(),D=new URL(a,i),J=await T(r,o,a,L,c,p);return D.search=new URLSearchParams({...l,partner_id:o,shop_id:p,access_token:c,sign:J,timestamp:L}).toString(),D.toString().replace(new RegExp("%26","g"),"&").replace(new RegExp("%3D","g"),"=")}class I{constructor(){this.logger=console,this.axios=b.create(),this.axios.interceptors.request.use(t=>(this.logger.log(`${t.url}`),t.data&&this.logger.info(`[Body]: ${JSON.stringify(t.data,null,4)}`),t),t=>(this.logger.error(t),t)),this.axios.interceptors.response.use(t=>(this.logger.log(`[Response]: ${JSON.stringify(t.data,null,4)}`),t),t=>{const{response:r,message:a,config:{method:i,url:c,data:u,params:_}}=t,o=r==null?void 0:r.status;return this.logger.error({status:o,message:a,method:i,url:c,data:u,params:_}),t})}static getInstance(){return this.instance??(this.instance=new I)}get(t,r){return this.axios.get(t,{params:r})}post(t,r,a){return this.axios.post(t,a,{params:r})}}class h{constructor(){}static getInstance(){return this.instance??(this.instance=new h)}get value(){return{partner_id:this.partnerId??"",partner_key:this.partnerKey??"",base_url:this.baseURL??"",access_token:this.accessToken??"",shop_id:this.shopId??""}}}const j=I.getInstance();function P(n){return async function(r){const a=n.transformRequestParameter??(l=>l),i=await n.requestParameterSchema.transform(a).safeParseAsync(r);if(!i.success)throw new Error(`parse request parameters error: ${i.error.message}`);const c=i.data,u=h.getInstance().value,_=await w({...u,path:n.path,params:c});let o;if(n.method==="POST"){const l=await n.requestBodySchema.safeParseAsync(n.body);if(!l.success)throw new Error(`parse request body error: ${l.error.message}`);o=(await j.post(_,{},n.body)).data}else o=(await j.get(_)).data;const p=await n.responseSchema.safeParseAsync(o);if(!p.success)throw new Error(`parse response error: ${p.error.message}`);return p.data}}const U="/api/v2/product/get_item_base_info",O="/api/v2/product/get_item_extra_info",v="/api/v2/product/get_item_list",q="/api/v2/product/get_model_list",E=["NORMAL","DELETED","UNLIST","BANNED"],x=e.z.object({item_id_list:e.z.string(),need_tax_info:e.z.coerce.boolean().optional(),need_complaint_policy:e.z.coerce.boolean().optional()}),K=e.z.object({error:e.z.string(),message:e.z.string(),warning:e.z.string(),request_id:e.z.string(),response:e.z.object({item_list:e.z.array(e.z.object({item_id:e.z.number(),category_id:e.z.number(),item_name:e.z.string(),item_sku:e.z.string(),create_time:e.z.number(),update_time:e.z.number(),attribute_list:e.z.array(e.z.object({attribute_id:e.z.number(),original_attribute_name:e.z.string(),is_mandatory:e.z.boolean(),attribute_value_list:e.z.array(e.z.object({value_id:e.z.number(),original_value_name:e.z.string(),value_unit:e.z.string()}))})).optional(),price_info:e.z.array(e.z.object({currency:e.z.string(),original_price:e.z.number(),current_price:e.z.number()})).optional(),stock_info_v2:e.z.object({summary_info:e.z.object({total_reserved_stock:e.z.number(),total_available_stock:e.z.number()}),seller_stock:e.z.array(e.z.object({location_id:e.z.string(),stock:e.z.number()})).optional()}).optional(),image:e.z.object({image_url_list:e.z.array(e.z.string()),image_id_list:e.z.array(e.z.string())}),weight:e.z.string(),dimension:e.z.object({package_length:e.z.number(),package_width:e.z.number(),package_height:e.z.number()}),logistic_info:e.z.array(e.z.object({logistic_id:e.z.number(),logistic_name:e.z.string(),enabled:e.z.boolean(),shipping_fee:e.z.number().optional(),is_free:e.z.boolean(),estimated_shipping_fee:e.z.number().optional()})),pre_order:e.z.object({is_pre_order:e.z.boolean(),days_to_ship:e.z.number()}),condition:e.z.string(),size_chart:e.z.string(),item_status:e.z.string(),has_model:e.z.boolean(),promotion_id:e.z.number().optional(),brand:e.z.object({brand_id:e.z.number(),original_brand_name:e.z.string()}),tax_info:e.z.object({ncm:e.z.number(),same_state_cfop:e.z.number(),diff_state_cfop:e.z.number(),csosn:e.z.number(),origin:e.z.number()}).optional(),description_type:e.z.string(),description_info:e.z.object({extended_description:e.z.object({field_list:e.z.array(e.z.object({field_type:e.z.string(),text:e.z.string().optional(),image_info:e.z.object({image_id:e.z.string(),image_url:e.z.string()}).optional()}))})})})).optional()})}),M=P({method:"GET",path:U,requestParameterSchema:x,responseSchema:K,transformRequestParameter(n){return n.need_tax_info=!!n.need_tax_info,n.need_complaint_policy=!!n.need_complaint_policy,n}}),d=e.z.object({item_id_list:e.z.string()}),C=e.z.object({error:e.z.string(),message:e.z.string(),warning:e.z.string().optional(),request_id:e.z.string(),response:e.z.object({item_list:e.z.array(e.z.object({item_id:e.z.number(),sale:e.z.number(),views:e.z.number(),likes:e.z.number(),rating_star:e.z.number(),comment_count:e.z.number()})).optional()}).optional()}),N=P({method:"GET",path:O,requestParameterSchema:d,responseSchema:C}),B=e.z.object({offset:e.z.number().int().min(0).optional(),page_size:e.z.number().int().positive().max(100).optional(),update_time_from:e.z.date().optional(),update_time_to:e.z.date().optional(),item_status:e.z.array(e.z.enum(E))}),G=e.z.object({error:e.z.string(),message:e.z.string().nullable().optional(),warning:e.z.string().nullable().optional(),request_id:e.z.string(),response:e.z.object({item:e.z.array(e.z.object({item_id:e.z.number().int(),item_status:e.z.enum(E),update_time:e.z.number().int()})).optional()}).optional(),total_count:e.z.number().int().optional(),has_next_page:e.z.boolean().optional(),next_offset:e.z.number().int().optional()}),V=P({method:"GET",path:v,requestParameterSchema:B,transformRequestParameter(n){return n.update_time_from=n.update_time_from??new Date("01/01/2022"),n.update_time_to=n.update_time_to??new Date,n},responseSchema:G}),z=Object.freeze(Object.defineProperty({__proto__:null,getItemBaseInfo:M,getItemExtraInfo:N,getItemList:V},Symbol.toStringTag,{value:"Module"})),R="/api/v2/shop/auth_partner";async function $({redirectURL:n,redirectSign:t}){const{baseURL:r,partnerId:a,partnerKey:i}=h.getInstance();if(!i||!a)throw new Error("partnerKey is undefined");const c=new URL(R,r),u=y(new Date),_=await T(i,a.toString(),R,u),o=new URL(n);return o.searchParams.append("sign",t),c.search=new URLSearchParams({partner_id:a.toString(),redirect:o.toString(),timestamp:u,sign:_}).toString(),c.toString()}const F=Object.freeze(Object.defineProperty({__proto__:null,product:z,shop:Object.freeze(Object.defineProperty({__proto__:null,authPartner:$},Symbol.toStringTag,{value:"Module"}))},Symbol.toStringTag,{value:"Module"})),A=e.z.object({partnerId:e.z.coerce.number().optional(),partnerKey:e.z.coerce.string().optional(),baseURL:e.z.coerce.string().url().optional(),accessToken:e.z.coerce.string().optional(),shopId:e.z.coerce.number().optional()}).safeParse({partnerId:process.env.SHOPEE_SDK_PARTNER_ID,partnerKey:process.env.SHOPEE_SDK_PARTNER_KEY,baseURL:process.env.SHOPEE_SDK_BASE_URL,accessToken:process.env.SHOPEE_SDK_ACCESS_TOKEN,shopId:process.env.SHOPEE_SDK_SHOP_ID});if(!A.success)throw new Error(A.error.message);const f=A.data,m=h.getInstance();class W{constructor(t){m.accessToken=t.accessToken??f.accessToken,m.baseURL=t.baseURL??f.baseURL,m.partnerId=t.partnerId??f.partnerId,m.partnerKey=t.partnerKey??f.partnerKey,m.shopId=t.shopId??f.shopId}setPartnerId(t){return m.partnerId=t,this}setBaseURL(t){return m.baseURL=t,this}setPartnerKey(t){return m.partnerKey=t,this}setAccessToken(t){return m.accessToken=t,this}setShopId(t){return m.shopId=t,this}get v2(){return F}}s.API_V2_PRODUCT_GET_ITEM_BASE_INFO_PATH=U,s.API_V2_PRODUCT_GET_ITEM_EXTRA_INFO_PATH=O,s.API_V2_PRODUCT_GET_ITEM_LIST_PATH=v,s.API_V2_PRODUCT_GET_MODEL_LIST_PATH=q,s.API_V2_SHOP_AUTH_PARTNER=R,s.ITEM_STATUS=E,s.ShopeeSdk=W,s.generateHmac=T,s.signURL=w,s.toTimestamp=y,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
