import{generateHmac}from"./generate-hmac.js";import{toTimestamp}from"./to-timestamp.js";export async function signURL(args){const{partner_id,partner_key,path,base_url,access_token,shop_id,params={}}=args;const parsedPartnerId=partner_id.toString();const parsedShopId=shop_id.toString();const parsedParams={};for(const key in params){const value=params[key];if(Array.isArray(value)){parsedParams[key]=[value[0],...value.slice(1).map(v=>`&${key}=${v}`)].join("")}else if(value instanceof Date){parsedParams[key]=toTimestamp(value)}else{parsedParams[key]=`${value}`}}const timestamp=toTimestamp();const url=new URL(path,base_url);const sign=await generateHmac(partner_key,parsedPartnerId,path,timestamp,access_token,parsedShopId);url.search=new URLSearchParams({...parsedParams,partner_id:parsedPartnerId,shop_id:parsedShopId,...!!access_token&&{access_token},sign,timestamp}).toString();return url.toString().replace(new RegExp("%26","g"),"&").replace(new RegExp("%3D","g"),"=")}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9zaWduLXVybC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTaG9wZWVDb250ZXh0IH0gZnJvbSBcIi4uL2xpYnMvaW5kZXguanNcIjtcblxuaW1wb3J0IHsgZ2VuZXJhdGVIbWFjIH0gZnJvbSBcIi4vZ2VuZXJhdGUtaG1hYy5qc1wiO1xuaW1wb3J0IHsgdG9UaW1lc3RhbXAgfSBmcm9tIFwiLi90by10aW1lc3RhbXAuanNcIjtcblxuZXhwb3J0IHR5cGUgU2lnblVSTEFyZ3MgPSBTaG9wZWVDb250ZXh0W1widmFsdWVcIl0gJiB7XG4gIHBhdGg6IHN0cmluZztcbiAgcGFyYW1zOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbn07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaWduVVJMKGFyZ3M6IFNpZ25VUkxBcmdzKSB7XG4gIGNvbnN0IHtcbiAgICBwYXJ0bmVyX2lkLFxuICAgIHBhcnRuZXJfa2V5LFxuICAgIHBhdGgsXG4gICAgYmFzZV91cmwsXG4gICAgYWNjZXNzX3Rva2VuLFxuICAgIHNob3BfaWQsXG4gICAgcGFyYW1zID0ge30sXG4gIH0gPSBhcmdzO1xuICBjb25zdCBwYXJzZWRQYXJ0bmVySWQgPSBwYXJ0bmVyX2lkLnRvU3RyaW5nKCk7XG4gIGNvbnN0IHBhcnNlZFNob3BJZCA9IHNob3BfaWQudG9TdHJpbmcoKTtcbiAgY29uc3QgcGFyc2VkUGFyYW1zID0ge30gYXMgUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcblxuICBmb3IgKGNvbnN0IGtleSBpbiBwYXJhbXMpIHtcbiAgICBjb25zdCB2YWx1ZSA9IHBhcmFtc1trZXldO1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICBwYXJzZWRQYXJhbXNba2V5XSA9IFtcbiAgICAgICAgdmFsdWVbMF0sXG4gICAgICAgIC4uLnZhbHVlLnNsaWNlKDEpLm1hcCgodikgPT4gYCYke2tleX09JHt2fWApLFxuICAgICAgXS5qb2luKFwiXCIpO1xuICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICBwYXJzZWRQYXJhbXNba2V5XSA9IHRvVGltZXN0YW1wKHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGFyc2VkUGFyYW1zW2tleV0gPSBgJHt2YWx1ZX1gO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHRpbWVzdGFtcCA9IHRvVGltZXN0YW1wKCk7XG5cbiAgY29uc3QgdXJsID0gbmV3IFVSTChwYXRoLCBiYXNlX3VybCk7XG5cbiAgY29uc3Qgc2lnbiA9IGF3YWl0IGdlbmVyYXRlSG1hYyhcbiAgICBwYXJ0bmVyX2tleSxcbiAgICBwYXJzZWRQYXJ0bmVySWQsXG4gICAgcGF0aCxcbiAgICB0aW1lc3RhbXAsXG4gICAgYWNjZXNzX3Rva2VuLFxuICAgIHBhcnNlZFNob3BJZFxuICApO1xuXG4gIHVybC5zZWFyY2ggPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcbiAgICAuLi5wYXJzZWRQYXJhbXMsXG4gICAgcGFydG5lcl9pZDogcGFyc2VkUGFydG5lcklkLFxuICAgIHNob3BfaWQ6IHBhcnNlZFNob3BJZCxcbiAgICAuLi4oISFhY2Nlc3NfdG9rZW4gJiYgeyBhY2Nlc3NfdG9rZW4gfSksXG4gICAgc2lnbixcbiAgICB0aW1lc3RhbXAsXG4gIH0pLnRvU3RyaW5nKCk7XG5cbiAgcmV0dXJuIHVybFxuICAgIC50b1N0cmluZygpXG4gICAgLnJlcGxhY2UobmV3IFJlZ0V4cChcIiUyNlwiLCBcImdcIiksIFwiJlwiKVxuICAgIC5yZXBsYWNlKG5ldyBSZWdFeHAoXCIlM0RcIiwgXCJnXCIpLCBcIj1cIik7XG59XG4iXSwibmFtZXMiOlsiZ2VuZXJhdGVIbWFjIiwidG9UaW1lc3RhbXAiLCJzaWduVVJMIiwiYXJncyIsInBhcnRuZXJfaWQiLCJwYXJ0bmVyX2tleSIsInBhdGgiLCJiYXNlX3VybCIsImFjY2Vzc190b2tlbiIsInNob3BfaWQiLCJwYXJhbXMiLCJwYXJzZWRQYXJ0bmVySWQiLCJ0b1N0cmluZyIsInBhcnNlZFNob3BJZCIsInBhcnNlZFBhcmFtcyIsImtleSIsInZhbHVlIiwiQXJyYXkiLCJpc0FycmF5Iiwic2xpY2UiLCJtYXAiLCJ2Iiwiam9pbiIsIkRhdGUiLCJ0aW1lc3RhbXAiLCJ1cmwiLCJVUkwiLCJzaWduIiwic2VhcmNoIiwiVVJMU2VhcmNoUGFyYW1zIiwicmVwbGFjZSIsIlJlZ0V4cCJdLCJtYXBwaW5ncyI6IkFBRUEsT0FBU0EsWUFBWSxLQUFRLG9CQUFxQixBQUNsRCxRQUFTQyxXQUFXLEtBQVEsbUJBQW9CLEFBT2hELFFBQU8sZUFBZUMsUUFBUUMsSUFBaUIsRUFDN0MsS0FBTSxDQUNKQyxVQUFVLENBQ1ZDLFdBQVcsQ0FDWEMsSUFBSSxDQUNKQyxRQUFRLENBQ1JDLFlBQVksQ0FDWkMsT0FBTyxDQUNQQyxPQUFTLENBQUMsQ0FBQyxDQUNaLENBQUdQLEtBQ0osTUFBTVEsZ0JBQWtCUCxXQUFXUSxRQUFRLEdBQzNDLE1BQU1DLGFBQWVKLFFBQVFHLFFBQVEsR0FDckMsTUFBTUUsYUFBZSxDQUFDLEVBRXRCLElBQUssTUFBTUMsT0FBT0wsT0FBUSxDQUN4QixNQUFNTSxNQUFRTixNQUFNLENBQUNLLElBQUksQ0FFekIsR0FBSUUsTUFBTUMsT0FBTyxDQUFDRixPQUFRLENBQ3hCRixZQUFZLENBQUNDLElBQUksQ0FBRyxDQUNsQkMsS0FBSyxDQUFDLEVBQUUsSUFDTEEsTUFBTUcsS0FBSyxDQUFDLEdBQUdDLEdBQUcsQ0FBQyxBQUFDQyxHQUFNLENBQUMsQ0FBQyxFQUFFTixJQUFJLENBQUMsRUFBRU0sRUFBRSxDQUFDLEVBQzVDLENBQUNDLElBQUksQ0FBQyxHQUNULE1BQU8sR0FBSU4saUJBQWlCTyxLQUFNLENBQ2hDVCxZQUFZLENBQUNDLElBQUksQ0FBR2QsWUFBWWUsTUFDbEMsS0FBTyxDQUNMRixZQUFZLENBQUNDLElBQUksQ0FBRyxDQUFDLEVBQUVDLE1BQU0sQ0FBQyxBQUNoQyxDQUNGLENBRUEsTUFBTVEsVUFBWXZCLGNBRWxCLE1BQU13QixJQUFNLElBQUlDLElBQUlwQixLQUFNQyxVQUUxQixNQUFNb0IsS0FBTyxNQUFNM0IsYUFDakJLLFlBQ0FNLGdCQUNBTCxLQUNBa0IsVUFDQWhCLGFBQ0FLLGFBR0ZZLENBQUFBLElBQUlHLE1BQU0sQ0FBRyxJQUFJQyxnQkFBZ0IsQ0FDL0IsR0FBR2YsWUFBWSxDQUNmVixXQUFZTyxnQkFDWkYsUUFBU0ksYUFDVCxHQUFJLENBQUMsQ0FBQ0wsY0FBZ0IsQ0FBRUEsWUFBYSxDQUFDLENBQ3RDbUIsS0FDQUgsU0FDRixHQUFHWixRQUFRLEdBRVgsT0FBT2EsSUFDSmIsUUFBUSxHQUNSa0IsT0FBTyxDQUFDLElBQUlDLE9BQU8sTUFBTyxLQUFNLEtBQ2hDRCxPQUFPLENBQUMsSUFBSUMsT0FBTyxNQUFPLEtBQU0sSUFDckMifQ==